<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>プログラミング環境テスト (Python対応)</title>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.9.5/brython.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 80%;
            margin: 10px;
        }
        #settingsIcon {
            cursor: pointer;
            font-size: 24px;
        }
        /* モーダル背景 */
        #modalBackground {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }
        /* モーダルウィンドウ */
        #settingsModal {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            width: 300px;
            position: relative;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        /* 閉じるボタン */
        #closeModal {
            position: absolute;
            right: 10px;
            bottom: 10px;
            padding: 5px 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        #closeModal:hover {
            background-color: #0056b3;
        }
        #editorContainer {
            display: flex;
            width: 80%;
            margin: 10px;
        }
        #lineNumbers {
            padding: 10px;
            border: 1px solid #ccc;
            background-color: #f4f4f4;
            color: #555;
            text-align: right;
            font-family: monospace;
            white-space: pre;
            user-select: none;
        }
        #codeEditor {
            flex: 1;
            height: 300px;
            padding: 10px;
            margin: 0;
            border: 1px solid #ccc;
            font-family: monospace;
            white-space: pre;
            overflow: auto;
            outline: none;
        }
        #consoleOutput {
            width: 80%;
            height: 200px;
            margin: 10px;
            padding: 10px;
            border: 1px solid #333;
            background-color: #000;
            color: #0f0;
            font-family: monospace;
            white-space: pre-wrap;
            overflow: auto;
        }
        #runButton {
            margin: 10px;
            padding: 10px 20px;
            cursor: pointer;
        }
        .error {
            color: #f00;
        }
    </style>
</head>
<body onload="brython()">
    <header>
        <h1>プログラミング環境テスト (Python対応)</h1>
        <div id="settingsIcon">⚙️</div>
    </header>

    <!-- 設定モーダル -->
    <div id="modalBackground">
        <div id="settingsModal">
            <h3>設定</h3>
            <label for="fontSize">文字サイズ:</label>
            <select id="fontSize">
                <option value="12">12px</option>
                <option value="14" selected>14px</option>
                <option value="16">16px</option>
                <option value="18">18px</option>
                <option value="20">20px</option>
                <option value="24">24px</option>
            </select>
            
            <br>
            <label for="fontSize">設定2；</label>
            
            <br>
            <label for="fontSize">設定3:</label>
            
            <button id="closeModal">閉じる</button>
        </div>
    </div>

    <div id="editorContainer">
        <div id="lineNumbers">1</div>
        <textarea id="codeEditor" placeholder="ここにPythonコードを入力"></textarea>
    </div>
    <button id="runButton">実行</button>
    <pre id="consoleOutput">実行結果がここに表示されます</pre>

    <script type="text/python">
        from browser import document

        console_output = document['consoleOutput']

        def custom_print(*args, sep=' ', end='\n', error=False):
            output = sep.join(map(str, args)) + end
            if error:
                console_output.innerHTML += f'<span class="error">{output}</span>'
            else:
                console_output.text += output

        print = custom_print

        def run_python_code(event):
            code = document['codeEditor'].value
            console_output.text = ""
            lines = code.split('\n')
            for line_number, line in enumerate(lines, start=1):
                try:
                    exec(line)
                except Exception as e:
                    error_message = f"エラー：{str(e)} (行: {line_number})"
                    print(error_message, error=True)
                    break

        run_button = document['runButton']
        run_button.bind('click', run_python_code)

        def toggle_modal(event):
            modal = document['modalBackground']
            modal.style.display = "flex" if modal.style.display == "none" else "none"

        def change_font_size(event):
            size = document['fontSize'].value + "px"
            document['codeEditor'].style.fontSize = size
            document['consoleOutput'].style.fontSize = size

        document['settingsIcon'].bind('click', toggle_modal)
        document['closeModal'].bind('click', toggle_modal)
        document['fontSize'].bind('change', change_font_size)
    </script>
</body>
</html>
